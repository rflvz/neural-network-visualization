<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizaci√≥n Neuronal z = Wx + b</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- KaTeX para renderizar matem√°ticas -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Panel de Control Lateral -->
        <aside id="control-panel">
            <header>
                <h1>Red Neuronal</h1>
                <p class="subtitle">Transformaci√≥n Af√≠n z = Wx + b</p>
            </header>

            <!-- Secci√≥n de Teor√≠a Colapsable -->
            <section class="theory-section">
                <button class="theory-toggle" id="theory-toggle">
                    <span class="toggle-icon">‚ñº</span>
                    <span>Teor√≠a: ¬øQu√© es z = Wx + b?</span>
                </button>
                <div class="theory-content" id="theory-content">
                    <div class="theory-card">
                        <h3>Transformaci√≥n Af√≠n en Redes Neuronales</h3>
                        <p>La operaci√≥n <strong>z = Wx + b</strong> es el c√°lculo fundamental en cada capa neuronal densa (forward pass).</p>
                        
                        <div class="component-list">
                            <div class="component-item">
                                <span class="component-icon weight">W</span>
                                <div>
                                    <strong>Matriz de Pesos</strong>
                                    <p>Pesos sin√°pticos que determinan la fuerza de conexi√≥n entre neuronas. El aprendizaje ajusta estos valores.</p>
                                </div>
                            </div>
                            <div class="component-item">
                                <span class="component-icon input">x</span>
                                <div>
                                    <strong>Vector de Entrada</strong>
                                    <p>Activaciones de la capa anterior que se propagan hacia adelante.</p>
                                </div>
                            </div>
                            <div class="component-item">
                                <span class="component-icon bias">b</span>
                                <div>
                                    <strong>Vector de Sesgo</strong>
                                    <p>Desplaza la funci√≥n de activaci√≥n, aumentando la flexibilidad del modelo.</p>
                                </div>
                            </div>
                            <div class="component-item">
                                <span class="component-icon output">z</span>
                                <div>
                                    <strong>Pre-activaci√≥n</strong>
                                    <p>Suma ponderada que se pasa a la funci√≥n de activaci√≥n: a = f(z)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Visualizaci√≥n Matem√°tica de Matrices -->
            <section class="math-display-section">
                <h2>Representaci√≥n Matem√°tica</h2>
                <div class="math-equation" id="main-equation">
                    <div class="matrix-container">
                        <span class="matrix-label">z</span>
                        <span class="equals">=</span>
                        <div class="matrix" id="matrix-w-display">
                            <div class="bracket left"></div>
                            <div class="matrix-values" id="w-values-display"></div>
                            <div class="bracket right"></div>
                        </div>
                        <span class="times">√ó</span>
                        <div class="vector" id="vector-x-display">
                            <div class="bracket left"></div>
                            <div class="vector-values" id="x-values-display"></div>
                            <div class="bracket right"></div>
                        </div>
                        <span class="plus">+</span>
                        <div class="vector" id="vector-b-display">
                            <div class="bracket left"></div>
                            <div class="vector-values" id="b-values-display"></div>
                            <div class="bracket right"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Inputs Editables -->
            <section class="inputs-section">
                <div class="input-group">
                    <h3>Matriz W <span class="dim">(3√ó3)</span></h3>
                    <div class="matrix-grid" id="matrix-w">
                        <!-- Generado por JS -->
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group half">
                        <h3>Vector x <span class="dim">(3√ó1)</span></h3>
                        <div class="vector-grid" id="vector-x"></div>
                    </div>
                    <div class="input-group half">
                        <h3>Vector b <span class="dim">(3√ó1)</span></h3>
                        <div class="vector-grid" id="vector-b"></div>
                    </div>
                </div>
            </section>

            <section class="controls-section">
                <button id="btn-animate" class="btn btn-primary">
                    <span class="icon">‚ñ∂</span> Animar C√°lculo Completo
                </button>
                <div class="btn-row">
                    <button id="btn-step1" class="btn btn-secondary">
                        Paso 1: W√óx
                    </button>
                    <button id="btn-step2" class="btn btn-secondary">
                        Paso 2: +b
                    </button>
                </div>
                <button id="btn-reset" class="btn btn-outline">
                    ‚Ü∫ Reiniciar valores
                </button>
            </section>

            <!-- Panel de C√°lculo Detallado -->
            <section class="calculation-panel">
                <h2>C√°lculo Paso a Paso</h2>
                <div class="calculation-container" id="calculation-container">
                    <div class="calculation-placeholder">
                        <span class="placeholder-icon">üìê</span>
                        <p>Presiona <strong>"Animar C√°lculo"</strong> para ver el proceso matem√°tico detallado</p>
                    </div>
                </div>
            </section>

            <!-- Resultados -->
            <section class="results-section">
                <h2>Resultados</h2>
                <div class="results-grid">
                    <div class="result-card" id="result-wx">
                        <div class="result-header">
                            <span class="result-label">Wx</span>
                            <span class="result-step">Paso 1</span>
                        </div>
                        <div class="result-vector">
                            <div class="bracket left small"></div>
                            <div class="result-values" id="wx-values">
                                <span>‚Äî</span>
                                <span>‚Äî</span>
                                <span>‚Äî</span>
                            </div>
                            <div class="bracket right small"></div>
                        </div>
                    </div>
                    <div class="result-card highlight" id="result-z">
                        <div class="result-header">
                            <span class="result-label">z = Wx + b</span>
                            <span class="result-step">Final</span>
                        </div>
                        <div class="result-vector">
                            <div class="bracket left small"></div>
                            <div class="result-values" id="z-values">
                                <span>‚Äî</span>
                                <span>‚Äî</span>
                                <span>‚Äî</span>
                            </div>
                            <div class="bracket right small"></div>
                        </div>
                    </div>
                </div>
            </section>
        </aside>

        <!-- Canvas de Three.js -->
        <main id="visualization">
            <canvas id="neural-canvas"></canvas>
            
            <!-- Overlay de f√≥rmulas animadas -->
            <div id="formula-overlay" class="formula-overlay hidden">
                <div class="formula-content" id="formula-content"></div>
            </div>
            
            <!-- Panel de c√°lculo actual en 3D -->
            <div id="current-calculation" class="current-calculation hidden">
                <div class="calc-title" id="calc-title">Calculando...</div>
                <div class="calc-detail" id="calc-detail"></div>
            </div>
            
            <div id="tooltip" class="tooltip hidden"></div>
            
            <div id="legend">
                <div class="legend-item">
                    <span class="dot input"></span> Neuronas de entrada (x)
                </div>
                <div class="legend-item">
                    <span class="dot output"></span> Neuronas de salida (z)
                </div>
                <div class="legend-item">
                    <span class="line positive"></span> Peso positivo (+)
                </div>
                <div class="legend-item">
                    <span class="line negative"></span> Peso negativo (‚àí)
                </div>
            </div>
            
            <div id="animation-status" class="hidden">
                <span class="pulse"></span>
                <span id="status-text">Calculando...</span>
            </div>
        </main>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <script type="module" src="main.js?v=5"></script>
</body>
</html>
